<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="icon" type="image/png" href="/assets/no_bg khxzi logo.png">
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Preview</title>
	<link rel="stylesheet" href="styles/main.css">
	<link rel="stylesheet" href="styles/themes.css">
	<link rel="stylesheet" href="styles/animations.css">
	<style>
		body {
			background-color: transparent;
			/* Allow theme bg to show */
			overflow-y: auto;
			padding: 1rem;
		}

		/* Scale down slightly for preview context if needed */
		.profile-container {
			margin-top: 2rem;
		}

		.discord-card {
			display: flex;
			flex-direction: column;
			gap: 1rem;
			padding: 1.5rem;
			border-radius: 12px;
			background: rgba(88, 101, 242, 0.1);
			border: 1px solid rgba(88, 101, 242, 0.3);
			text-align: left;
			margin-top: 2rem;
		}

		.discord-header {
			display: flex;
			align-items: center;
			gap: 1rem;
		}

		.discord-avatar {
			width: 60px;
			height: 60px;
			border-radius: 50%;
			border: 2px solid #5865F2;
		}

		.discord-name {
			font-size: 1.2rem;
			font-weight: bold;
		}

		.discord-badges {
			display: flex;
			gap: 0.5rem;
			margin-top: 0.25rem;
			flex-wrap: wrap;
		}

		.badge {
			background: rgba(255, 255, 255, 0.1);
			padding: 2px 6px;
			border-radius: 4px;
			font-size: 0.7rem;
		}

		.discord-connections {
			display: flex;
			flex-wrap: wrap;
			gap: 0.5rem;
			margin-top: 0.5rem;
		}

		.discord-connection {
			background: rgba(0, 0, 0, 0.3);
			padding: 0.5rem 1rem;
			border-radius: 8px;
			font-size: 0.8rem;
			border: 1px solid rgba(255, 255, 255, 0.1);
		}
	</style>
</head>

<body>
	<div id="profileContainer" class="profile-container fade-in">
		<div class="avatar-container">
			<img id="avatar" src="" alt="Avatar" class="avatar">
		</div>
		<h1 id="username" class="username"></h1>
		<p id="bio" class="bio"></p>

		<div id="links" class="links-grid">
			<!-- Links -->
		</div>
	</div>

	<script>
		window.addEventListener('message', (event) => {
			const data = event.data;
			if (!data) return;

			// Apply Theme
			document.body.className = `theme-${data.theme || 'red-black'}`;

			// Update Content
			document.getElementById('username').textContent = data.username || 'Username';
			document.getElementById('bio').textContent = data.bio || '';
			document.getElementById('avatar').src = data.avatar || 'assets/khxzilogo.png';

			// Update Links
			const linksContainer = document.getElementById('links');
			linksContainer.innerHTML = '';

			if (data.links) {
				data.links.forEach(link => {
					const a = document.createElement('a');
					a.href = link.url || '#';
					a.className = 'link-card';
					a.target = '_blank';
					a.innerHTML = `<span>${link.label || 'Link'}</span>`;
					linksContainer.appendChild(a);
				});
			}

			// Discord Card
			const existingDiscord = document.querySelector('.discord-card');
			if (existingDiscord) existingDiscord.remove();

			if (data.discord) {
				const flags = data.discord.public_flags || 0;
				const badges = [];
				if (flags & 1) badges.push('Staff');
				if (flags & 2) badges.push('Partner');
				if (flags & 4) badges.push('HypeSquad');
				if (flags & 8) badges.push('Bug Hunter');
				if (flags & 64) badges.push('Bravery');
				if (flags & 128) badges.push('Brilliance');
				if (flags & 256) badges.push('Balance');
				if (flags & 512) badges.push('Early Supporter');
				if (flags & 131072) badges.push('Verified Dev');
				if (flags & 4194304) badges.push('Active Dev');

				const badgesHtml = badges.map(b => `<span class="badge">${b}</span>`).join('');

				const connectionsHtml = data.discord.connections ? data.discord.connections.map(c => `
                    <div class="discord-connection" title="${c.type}">
                        <span style="opacity: 0.7; margin-right: 5px; text-transform: capitalize;">${c.type}:</span> ${c.name}
                    </div>
                `).join('') : '';

				const discordCard = document.createElement('div');
				discordCard.className = 'discord-card glass-panel fade-in';
				discordCard.innerHTML = `
                    <div class="discord-header">
                        <img src="https://cdn.discordapp.com/avatars/${data.discord.id}/${data.discord.avatar}.png" class="discord-avatar">
                        <div class="discord-info">
                            <div class="discord-name">${data.discord.username}</div>
                            <div class="discord-badges">${badgesHtml}</div>
                        </div>
                    </div>
                    ${connectionsHtml ? `<div class="discord-connections">${connectionsHtml}</div>` : ''}
                `;
				document.getElementById('profileContainer').appendChild(discordCard);
			}
		});
	</script>
</body>

</html>